### Aula 20: Exercícios Práticos de Flask (Rotas, Templates, Banco de Dados)
![](./assets/20.jpeg)
#### Introdução

Nesta aula, vamos revisar os conceitos aprendidos sobre **Flask** com exercícios práticos que combinam a criação de rotas, o uso de templates e a integração com banco de dados. O objetivo é colocar em prática os conhecimentos adquiridos até agora, criando uma pequena aplicação web com funcionalidade completa.

### O que vamos praticar?

1. **Rotas**: Definiremos rotas que respondem a diferentes URLs.
2. **Templates**: Usaremos o **Jinja2** para renderizar templates HTML dinâmicos.
3. **Banco de Dados**: Usaremos o **SQLite** para armazenar e consultar dados, criando uma aplicação simples que permite adicionar e listar itens de um banco de dados.

### Estrutura do Projeto

Vamos começar configurando a estrutura básica do projeto Flask:

```
meu_projeto/
│
├── app/
│   ├── templates/
│   │   └── index.html
│   │   └── adicionar.html
│   ├── __init__.py
│   ├── models.py
│   ├── routes.py
│
├── run.py
├── venv/
└── meu_banco_de_dados.db
```

1. **`models.py`**: Definiremos os modelos de dados que representam tabelas do banco de dados.
2. **`templates/`**: Contém os arquivos HTML que serão renderizados nas rotas.
3. **`routes.py`**: Onde definimos as rotas e conectamos com o banco de dados e templates.

### Exercício 1: Criando a Primeira Rota e Template

Vamos criar a rota para a página inicial da aplicação.

#### Passo 1: Definir a Rota

1. No arquivo `app/routes.py`, adicione o seguinte código:

   ```python
   from flask import render_template
   from app import app

   @app.route('/')
   def index():
       return render_template('index.html')
   ```

Aqui estamos definindo a rota para a página inicial (`/`) e renderizando o template `index.html`.

#### Passo 2: Criar o Template

2. Na pasta `app/templates`, crie um arquivo chamado `index.html` com o seguinte conteúdo:

   ```html
   <!DOCTYPE html>
   <html lang="pt-BR">
   <head>
       <meta charset="UTF-8">
       <meta name="viewport" content="width=device-width, initial-scale=1.0">
       <title>Página Inicial</title>
   </head>
   <body>
       <h1>Bem-vindo à Minha Aplicação Flask!</h1>
       <p>Esta é a página inicial.</p>
       <a href="/adicionar">Adicionar um novo item</a>
   </body>
   </html>
   ```

Essa página contém um link que leva à rota onde adicionaremos um novo item ao banco de dados.

### Exercício 2: Adicionando Itens ao Banco de Dados

Agora, vamos criar uma rota e template para adicionar itens ao banco de dados.

#### Passo 1: Definir o Modelo de Dados

No arquivo `app/models.py`, defina o modelo que representa a tabela do banco de dados:

```python
from app import db

class Item(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    nome = db.Column(db.String(100), nullable=False)

    def __repr__(self):
        return f'<Item {self.nome}>'
```

#### Passo 2: Criar a Rota para Adicionar Itens

No arquivo `app/routes.py`, adicione a rota para exibir o formulário de adicionar e salvar o item no banco de dados:

```python
from flask import render_template, request, redirect, url_for
from app import app, db
from app.models import Item

@app.route('/adicionar', methods=['GET', 'POST'])
def adicionar():
    if request.method == 'POST':
        nome_do_item = request.form['nome']
        novo_item = Item(nome=nome_do_item)
        db.session.add(novo_item)
        db.session.commit()
        return redirect(url_for('index'))
    return render_template('adicionar.html')
```

Aqui, a rota `/adicionar` aceita métodos GET e POST. Quando o método é POST (ao enviar o formulário), o novo item é adicionado ao banco de dados.

#### Passo 3: Criar o Template para o Formulário

Na pasta `app/templates`, crie o arquivo `adicionar.html`:

```html
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adicionar Item</title>
</head>
<body>
    <h1>Adicionar Novo Item</h1>
    <form action="/adicionar" method="POST">
        <label for="nome">Nome do Item:</label>
        <input type="text" id="nome" name="nome" required>
        <button type="submit">Adicionar</button>
    </form>
    <a href="/">Voltar à página inicial</a>
</body>
</html>
```

Esse formulário coleta o nome de um item e o envia para o servidor.

### Exercício 3: Listando Itens do Banco de Dados

Agora, vamos modificar a página inicial para listar os itens armazenados no banco de dados.

#### Passo 1: Modificar a Rota para Listar Itens

No arquivo `app/routes.py`, modifique a rota `index` para buscar os itens do banco de dados e exibi-los na página inicial:

```python
@app.route('/')
def index():
    itens = Item.query.all()
    return render_template('index.html', itens=itens)
```

#### Passo 2: Modificar o Template `index.html`

Modifique o arquivo `app/templates/index.html` para exibir a lista de itens:

```html
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Página Inicial</title>
</head>
<body>
    <h1>Bem-vindo à Minha Aplicação Flask!</h1>
    <p>Esta é a página inicial.</p>

    <h2>Lista de Itens</h2>
    <ul>
        {% for item in itens %}
            <li>{{ item.nome }}</li>
        {% endfor %}
    </ul>

    <a href="/adicionar">Adicionar um novo item</a>
</body>
</html>
```

### Conclusão

Com esses exercícios práticos, você conseguiu:
1. Criar rotas para exibir e adicionar dados.
2. Usar templates dinâmicos com **Jinja2**.
3. Integrar o Flask com o banco de dados **SQLite** para armazenar e consultar informações.

### Exercícios Práticos

1. **Exclusão de Itens**: Crie uma rota e um botão para permitir que os itens sejam excluídos da lista.
2. **Edição de Itens**: Crie uma rota para editar os itens já armazenados no banco de dados.
3. **Validação de Formulário**: Adicione validação ao formulário de adição de itens, garantindo que o nome do item não seja deixado em branco.

Esses exercícios ajudarão a reforçar o entendimento sobre rotas, templates e banco de dados no Flask, permitindo criar aplicações web dinâmicas e interativas.